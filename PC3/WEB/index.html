<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8" />
  <title>myTUB - Estacionamento</title>
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#0066CC" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

  <!-- App CSS -->
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="payment.css" />
</head>

<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="screen" aria-label="Ecr√£ de login">
    <div class="login-container">
      <img src="logo.png" alt="myTUB Logo" class="logo">
      <h1>myTUB</h1>
      <p class="subtitle">Estacionamento para Clientes</p>

      <!-- Login Form -->
      <form id="loginForm" aria-label="Formul√°rio de login">
        <div class="form-group">
          <label for="clientName">Nome</label>
          <input type="text" id="clientName" required aria-required="true" autocomplete="name"
            placeholder="Insira o seu nome">
        </div>

        <div class="form-group">
          <label for="clientPassword">Palavra-passe</label>
          <input type="password" id="clientPassword" required aria-required="true" autocomplete="current-password"
            placeholder="Insira a palavra-passe">
        </div>

        <button type="submit" class="btn btn-primary">Entrar</button>
      </form>
    </div>
  </div>

  <!-- Main App (hidden by default) -->
  <div id="appScreen" class="hidden">
    <header id="app-header">
      <div class="header-branding">
        <img src="logo.png" alt="Logo" class="header-logo">
        <h1>
          <span class="my">my</span><span class="tub">TUB</span>
          <span class="est">Estacionamento</span>
        </h1>
      </div>

    </header>

    <!-- Account Screen (Moved inside appScreen) -->
    <div id="account-screen" class="hidden">
      <!-- Content injected by JS -->
    </div>

    <main id="app-content">

      <div id="map"></div>

      <div id="bottom-panel">
        <div>
          <div class="legend">
            <span class="dot green"></span><span>Livres</span>
            <span class="dot red"></span><span>Ocupados</span>
          </div>
          <div id="availability-stats" class="availability-stats">
            <span id="available-count" class="stat-item">
              <strong class="stat-number">0</strong>
              <span class="stat-label">dispon√≠veis</span>
            </span>
            <span class="stat-separator">‚Ä¢</span>
            <span id="occupied-count" class="stat-item">
              <strong class="stat-number">0</strong>
              <span class="stat-label">ocupados</span>
            </span>
          </div>
        </div>
        <button id="refresh-btn">Atualizar</button>
      </div>

      <!-- Bottom Navigation Bar (Moved inside appScreen) -->
      <nav class="bottom-nav">
        <button class="nav-item">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span class="nav-label">Defini√ß√µes</span>
        </button>

        <div class="nav-center-wrapper">
          <div class="nav-curve-bg"></div>
          <button class="nav-center-btn">
            <svg class="nav-center-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 19.618V8.618a1 1 0 00-1.447-.894L14 7m0 13V7m0-3L9 7" />
            </svg>
          </button>
          <span class="nav-center-label">Mapa</span>
        </div>

        <button id="nav-account-btn" class="nav-item">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          <span class="nav-label">Conta</span>
        </button>
      </nav>

      <!-- Place Panel (Bottom Drawer) -->
      <div id="place-panel" class="hidden">
        <div class="place-header">
          <div class="place-title-row">
            <h3 id="place-title">Lugar</h3>

          </div>
          <button id="place-close" class="close-btn" aria-label="Fechar">√ó</button>
        </div>

        <div class="place-body">
          <div class="status-row">
            <span class="status-label">Estado:</span>
            <span id="place-status" class="status-badge">Livre</span>
          </div>

          <p class="state-text" id="place-state-text">O lugar est√° livre.</p>

          <button id="start-session-btn" class="btn-primary btn-full">
            Criar sess√£o de estacionamento
          </button>

          <!-- Session Form (hidden by default) -->
          <div id="session-form" class="session-form hidden">
            <div class="form-row">
              <label for="matricula-input">Matr√≠cula</label>
              <input type="text" id="matricula-input" placeholder="AA-00-BB" maxlength="8" />
            </div>

            <div class="form-row">
              <label for="duracao-input">Dura√ß√£o (minutos)</label>
              <input type="number" id="duracao-input" placeholder="60" min="1" />
            </div>

            <button id="confirm-session-btn" type="button" class="btn-primary">Confirmar</button>
            <button id="cancel-session-btn" type="button" class="btn-secondary">Cancelar</button>
          </div>
        </div>
      </div>
  </div>

  </main>

  <!--  Payment Screen (Via Verde Style) -->
  <div id="payment-screen" class="hidden">
    <div class="via-verde-container">
      <h2 class="vv-title">myTUB Estacionamento</h2>

      <div class="location-display">
        <span class="pin-icon">üìç</span>
        <span id="location-name">Localiza√ß√£o do Estacionamento</span>
      </div>

      <div class="map-background" id="map-background"></div>

      <div class="timer-circle">
        <div class="timer-icon">üïê</div>
        <div class="timer-display" id="timer-display">00:00</div>
        <div class="price-badge" id="price-badge">0,00 ‚Ç¨</div>
      </div>

      <div class="session-info">
        <div class="session-col">
          <div class="session-label">In√≠cio</div>
          <div class="session-time" id="session-start-time">--:--</div>
          <div class="session-date">
            <span id="session-start-date">--/--/----</span>
            <span class="weekday-badge" id="session-start-weekday">---</span>
          </div>
        </div>
        <div class="session-col">
          <div class="session-label">V√°lido at√©</div>
          <div class="session-time" id="session-end-time">--:--</div>
          <div class="session-date">
            <span id="session-end-date">--/--/----</span>
            <span class="weekday-badge" id="session-end-weekday">---</span>
          </div>
        </div>
      </div>

      <div class="plate-display">
        <span class="car-icon">üöó</span>
        <span id="session-plate-number">AA-00-BB</span>
      </div>

      <div class="action-buttons">
        <button id="payment-cancel-btn" class="btn-cancel-vv">Cancelar</button>
        <button id="payment-confirm-btn" class="btn-start-vv">Iniciar</button>
      </div>
    </div>
  </div>

  <!-- Payment Method Modal -->
  <!-- Bottom Navigation Bar -->


  <div id="payment-method-modal" class="modal hidden">
    <div class="method-card">
      <div class="method-card-header">
        <h3>Selecionar M√©todo de Pagamento</h3>
        <button id="close-method-modal" class="close-btn" aria-label="Fechar">√ó</button>
      </div>

      <div class="method-list">
        <button class="method-option" data-method="Apple Pay">
          <span class="method-name">Apple Pay</span>
        </button>
        <button class="method-option" data-method="MB WAY">
          <span class="method-name">MB WAY</span>
        </button>
        <button class="method-option" data-method="Cart√£o banc√°rio">
          <span class="method-name">Cart√£o banc√°rio</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast hidden"></div>



  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <!-- App JS Modules -->
  <script src="map.js"></script>


  <script src="auth.js"></script>
  <script src="payment.js"></script>
  <script src="main.js"></script>
</body>

</html>